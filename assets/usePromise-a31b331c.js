import{j as r,e as v,r as h,f as E,B as A,u as D,g as G,I as x,s as R}from"./index-63aba1ae.js";import{u as F,j as z,k as $}from"./files-7f8aac1f.js";function H(t){return new Promise(e=>{var s;const n=()=>{prompt("Copy this to clipboard!",t),e()};(s=navigator==null?void 0:navigator.clipboard)!=null&&s.writeText?navigator.clipboard.writeText(t).then(()=>e()).catch(n):n()})}function U(t){return navigator.share({text:t})}function W(t){try{return U(t).then(()=>"os")}catch{return H(t).then(()=>"clipboard")}}const Y={onMenu:()=>{},onClick:()=>{}};function B({children:t,className:e}){return r.jsx("ul",{className:v("x-list",e),children:t})}function O(t){const{children:e,className:n,clickable:s,selected:a,onClick:l,onMenu:u}={...Y,...t},o=h.useCallback(m=>{m.preventDefault(),u(m)},[u]);return r.jsx("li",{className:v("x-list-item",s&&"x-list-item-clickable",a&&"x-list-item-selected",n),...s&&{onContextMenu:o,onClick:l,tabIndex:1},children:e})}function _(t){const{children:e,className:n,...s}={...E,...t};return r.jsx(A,{className:v("x-menu-activator",n),...s,children:e})}function p({children:t,className:e,onClick:n}){return r.jsx(O,{clickable:!0,className:v("p-3 py-3 min-h-[4.5rem] flex flex-row items-center gap-4",e),...n&&{onClick:n},children:t})}function q({children:t,className:e}){const n=h.Children.map(t,a=>(a==null?void 0:a.type)===_?a:null),s=h.Children.map(t,a=>(a==null?void 0:a.type)===p?a:null);return r.jsxs("div",{className:v("x-menu group",e),children:[n,r.jsx("div",{className:"hidden group-focus-within:block absolute bg-section-normal text-section-content shadow-2xl w-80 right-0 mt-4 mr-2 rounded-xl overflow-hidden z-10",children:r.jsx(B,{className:"!gap-0",children:s})})]})}function te({title:t,subtitle:e,startButtons:n}){const[s,a]=F(),l=D(),{pathname:u}=G(),o=()=>{if(!s)return;const g=z(s);$(g)},m=h.useMemo(()=>{if(s)return`/encrypt/${encodeURIComponent(s.public_key)}`},[]),L=()=>{m&&W(m).then(g=>{g==="clipboard"&&R("Share Link Copied To Clipboard!")})};return r.jsxs("header",{className:"h-[4.5rem] shrink-0 flex items-center bg-section-normal text-section-content p-3 gap-3",children:[n&&r.jsx("div",{children:n}),r.jsxs("div",{className:"flex-grow flex flex-row items-center gap-3",children:[r.jsx("img",{src:"/guard/logo_white.svg",className:"w-10 h-10",alt:"Guard Logo"}),r.jsxs("div",{children:[t&&r.jsx("h2",{className:"text-xl font-semibold",children:t}),e&&r.jsx("p",{className:"text-xs text-section-subtitle",children:e})]})]}),r.jsx("a",{className:"x-button x-button-transparent x-button-rounded x-button-lg x-button-circle",href:"https://github.com/nainemom/guard",target:"_blank","aria-label":"Github Page",children:r.jsx(x,{name:"github",className:"h-6 w-6"})}),r.jsxs(q,{children:[r.jsx(_,{circle:!0,theme:"transparent",size:"lg",ariaLabel:"Profile Menu",children:r.jsx(x,{name:"manage_accounts",className:"w-8 h-8"})}),s&&u!=="/decrypt"&&r.jsxs(p,{onClick:()=>l("/decrypt"),children:[r.jsx(x,{name:"drafts",className:"w-6 h-6"}),r.jsxs("div",{children:[r.jsx("h3",{children:"Decrypt"}),r.jsx("p",{className:"text-xs text-section-subtitle",children:"You can decrypt your encrypted message through this page"})]})]},"decrypt"),s&&m&&!u.startsWith("/encrypt")&&r.jsxs(p,{onClick:()=>l(m),children:[r.jsx(x,{name:"mail_lock",className:"w-6 h-6"}),r.jsxs("div",{children:[r.jsx("h3",{children:"Encrypt"}),r.jsx("p",{className:"text-xs text-section-subtitle",children:"Your encryptor page (Guard Link)"})]})]},"encrypt"),s&&r.jsxs(p,{onClick:()=>L(),children:[r.jsx(x,{name:"share",className:"w-6 h-6 shrink-0"}),r.jsxs("div",{children:[r.jsx("h3",{children:"Share"}),r.jsx("p",{className:"text-xs text-section-subtitle",children:"Share your Guard Link to let others encrypt data for you"})]})]},"share"),s&&r.jsxs(p,{onClick:()=>o(),children:[r.jsx(x,{name:"save",className:"w-6 h-6 shrink-0"}),r.jsxs("div",{children:[r.jsx("h3",{children:"Export"}),r.jsx("p",{className:"text-xs text-section-subtitle",children:"Generate a .auth file from your account to access it in future"})]})]},"export"),s&&r.jsxs(p,{onClick:()=>a(null),children:[r.jsx(x,{name:"logout",className:"w-6 h-6 shrink-0"})," Logout"]},"logout"),!s&&r.jsxs(p,{onClick:()=>l("/setup"),children:[r.jsx(x,{name:"login",className:"w-6 h-6"}),r.jsxs("div",{children:[r.jsx("h3",{children:"Login"}),r.jsx("p",{className:"text-xs text-section-subtitle",children:"Login to your own account or just generate a new account"})]})]})]})]})}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S(t,e,n){J(t,e),e.set(t,n)}function J(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(t,e){var n=I(t,e,"get");return K(t,n)}function K(t,e){return e.get?e.get.call(t):e.value}function T(t,e,n){var s=I(t,e,"set");return Q(t,s,n),n}function I(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function Q(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}var V=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",c=new WeakMap,b=new WeakMap;class y{constructor(e){var{executor:n=()=>{},internals:s=P(),promise:a=new Promise((l,u)=>n(l,u,o=>{s.onCancelList.push(o)}))}=e;S(this,c,{writable:!0,value:void 0}),S(this,b,{writable:!0,value:void 0}),f(this,V,"CancelablePromise"),this.cancel=this.cancel.bind(this),T(this,c,s),T(this,b,a||new Promise((l,u)=>n(l,u,o=>{s.onCancelList.push(o)})))}then(e,n){return C(i(this,b).then(w(e,i(this,c)),w(n,i(this,c))),i(this,c))}catch(e){return C(i(this,b).catch(w(e,i(this,c))),i(this,c))}finally(e,n){return n&&i(this,c).onCancelList.push(e),C(i(this,b).finally(w(()=>{if(e)return n&&(i(this,c).onCancelList=i(this,c).onCancelList.filter(s=>s!==e)),e()},i(this,c))),i(this,c))}cancel(){i(this,c).isCanceled=!0;var e=i(this,c).onCancelList;i(this,c).onCancelList=[];for(var n of e)if(typeof n=="function")try{n()}catch(s){console.error(s)}}isCanceled(){return i(this,c).isCanceled===!0}}class d extends y{constructor(e){super({executor:e})}}f(d,"all",function(e){return N(e,Promise.all(e))});f(d,"allSettled",function(e){return N(e,Promise.allSettled(e))});f(d,"any",function(e){return N(e,Promise.any(e))});f(d,"race",function(e){return N(e,Promise.race(e))});f(d,"resolve",function(e){return M(Promise.resolve(e))});f(d,"reject",function(e){return M(Promise.reject(e))});f(d,"isCancelable",k);function M(t){return C(t,P())}function k(t){return t instanceof d||t instanceof y}function w(t,e){if(t)return n=>{if(!e.isCanceled){var s=t(n);return k(s)&&e.onCancelList.push(s.cancel),s}return n}}function C(t,e){return new y({internals:e,promise:t})}function N(t,e){var n=P();return n.onCancelList.push(()=>{for(var s of t)k(s)&&s.cancel()}),new y({internals:n,promise:e})}function P(){return{isCanceled:!1,onCancelList:[]}}const X=t=>new d((e,n,s)=>{let a=setTimeout(e,t);s(()=>{clearTimeout(a)})});function ne(t,e={respectLoading:!1,debounceTimer:0}){const[n,s]=h.useState("none"),a=h.useRef(),l=h.useRef(),u=h.useRef(),o=h.useRef(),m=()=>{clearTimeout(u.current),o.current&&k(o.current)&&o.current.cancel(),o.current=void 0,s("none")},L=(...g)=>(e.respectLoading&&n==="loading"||(m(),s("loading"),o.current=X(e.debounceTimer).then(()=>t(...g)).then(j=>(l.current=void 0,a.current=j,s("resolved"),j)).catch(j=>{throw l.current=j,a.current=void 0,s("rejected"),j})),o.current);return h.useEffect(()=>()=>{m(),s("none")},[]),h.useMemo(()=>({state:n,response:a.current,error:l.current,refresh:L}),[n])}export{te as H,W as s,ne as u};
